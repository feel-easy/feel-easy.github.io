<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
  <title>golang结构体标签  我的主页</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="/css/iLiKE.css">
    
      <link rel="stylesheet" href="/css/github.min.css">
    
  
  
    <!-- Highlight.js -->
    <!-- <link rel="stylesheet"
          href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css"> -->
    <!-- <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js"> -->
    </script>
    <script>
        hljs.initHighlightingOnLoad();
    </script>
  
  
<meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="我的主页" type="application/atom+xml">
</head>
<body>
    <div class="header">
        <div class="container">
    <div class="menu">
      <div class="menu-left">
        <a href="/">
          <!-- <img src="/favicon.ico"></img> -->
        </a>
      </div>
      <div class="menu-right">
        
          
          
          
          
          
          <a href="/">首页</a>
        
          
          
          
          
          
          <a href="/archives">归档</a>
        
      </div>
    </div>
</div>
    </div>
    <div class="container">
        <h1 class="post-title">golang结构体标签</h1>
<article class="post markdown-style">
  <h2 id="结构体标签"><a href="#结构体标签" class="headerlink" title="结构体标签"></a>结构体标签</h2><h3 id="标签定义"><a href="#标签定义" class="headerlink" title="标签定义"></a>标签定义</h3><p>Tag是结构体在编译阶段关联到成员的元信息字符串，在运行的时候通过反射的机制读取出来。</p>
<p>结构体标签由一个或多个键值对组成。键与值使用冒号分隔，值用双引号括起来。键值对之间使用一个空格分隔，具体的格式如下：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">`key1:&quot;value1&quot; key2:&quot;value2&quot; key3:&quot;value3&quot;...`</span>  <span class="comment">// 键值对用空格分隔</span></span><br></pre></td></tr></table></figure>
<p>key会指定反射的解析方式，如下： json(JSON标签) orm(Beego标签)、gorm(GORM标签)、bson(MongoDB标签)、form(表单标签)、binding(表单验证标签)</p>
<h3 id="标签选项"><a href="#标签选项" class="headerlink" title="标签选项"></a>标签选项</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID   <span class="keyword">int</span>     <span class="string">`json:&quot;-&quot;`</span>            <span class="comment">// 该字段不进行序列化</span></span><br><span class="line">    Name <span class="keyword">string</span>  <span class="string">`json:name,omitempy`</span>  <span class="comment">// 如果为类型零值或空值，序列化时忽略该字段</span></span><br><span class="line">    Age  <span class="keyword">int</span>     <span class="string">`json:age,string`</span>     <span class="comment">// 指定类型，支持string、number、boolen</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：encoding/json<a target="_blank" rel="noopener" href="https://studygolang.com/static/pkgdoc/pkg/encoding_json.htm">官方文档</a></p>
<h2 id="json标签"><a href="#json标签" class="headerlink" title="json标签"></a>json标签</h2><h3 id="JSON说明"><a href="#JSON说明" class="headerlink" title="JSON说明"></a>JSON说明</h3><p>JSON<code>数组</code>可以用于编码Go语言的<code>数组</code>和<code>slice</code>；由于JSON<code>对象</code>是一个字符串到值的映射，写成一系列的<code>name:value</code>对形式，因此JSON的<code>对象</code>类型可以用于编码Go语言的<code>map</code>和<code>结构体</code>。</p>
<p>将Go语言中结构体<code>slice</code>转为JSON的过程叫<code>编组</code>(marshaling)，编组通过<code>json.Marshal</code>函数完成。在编码时，默认使用Go语言结构体的成员名字作为JSON的对象（通过reflect反射技术）。只有导出的结构体成员才会被编码。</p>
<p>如果在结构体slice编码成JSON的时候使用自定义的成员名，可以使用<code>结构体成员Tag</code>来实现。</p>
<h3 id="JSON标签"><a href="#JSON标签" class="headerlink" title="JSON标签"></a>JSON标签</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID   <span class="keyword">int</span> <span class="string">`json:&quot;id&quot;`</span>  <span class="comment">// 编码后的字段名为 id</span></span><br><span class="line">    Name <span class="keyword">string</span>           <span class="comment">// 编码后的字段名为 自定义成员名 Name</span></span><br><span class="line">    age  <span class="keyword">int</span>              <span class="comment">// 未导出字段不能编码</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>json</code>为键名的标签对应的值用于控制<code>encoding/json</code>包的编码和解码的行为，并且<code>encoding/...</code>下面其它的包也遵循这个约定。</p>
<table>
<thead>
<tr>
<th>标签选项</th>
<th>使用说明</th>
</tr>
</thead>
<tbody><tr>
<td>-</td>
<td>字段不进行序列化 例：<code>json:&quot;-&quot;</code></td>
</tr>
<tr>
<td>omitempy</td>
<td>类型零值或空值，序列化时忽略该字段 例：<code>json:&quot;,omitempy&quot;</code> 字段名省略的话用结构体字段名</td>
</tr>
<tr>
<td>type</td>
<td>重新指定字段类型 例：<code>json:&quot;age,string&quot;</code></td>
</tr>
</tbody></table>
<h2 id="gorm标签"><a href="#gorm标签" class="headerlink" title="gorm标签"></a>gorm标签</h2><h3 id="模型定义"><a href="#模型定义" class="headerlink" title="模型定义"></a>模型定义</h3><p>模型是标准的 struct,由基本数据类型以及实现了<em>Scanner</em>和<em>Valuer</em>接口的自定义类型及其指针或别名组成。</p>
<p>GORM 定义一个 gorm.Model 结构体，如下所示：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Model <span class="keyword">struct</span> &#123;</span><br><span class="line">  ID        <span class="keyword">uint</span>           <span class="string">`gorm:&quot;primaryKey&quot;`</span></span><br><span class="line">  CreatedAt time.Time</span><br><span class="line">  UpdatedAt time.Time</span><br><span class="line">  DeletedAt gorm.DeletedAt <span class="string">`gorm:&quot;index&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">gorm<span class="string">`为键名的标签遵循GORM的解析规则，GORM支持如下tag，tag名大小写不敏感，建议使用`</span>camelCase<span class="string">`风格，多个标签定义用`</span>分号(;)分隔</span><br></pre></td></tr></table></figure>
<p><code>[知识点]</code> Gorm建表时 AUTO_INCREMENT 不生效的问题</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AUTO_INCREMENT 不生效</span></span><br><span class="line">Id  <span class="keyword">uint64</span> <span class="string">`gorm:&quot;column:id;primaryKey;type:bigint(20);autoIncrement;comment:&#x27;主键&#x27;&quot;`</span></span><br><span class="line"><span class="comment">// AUTO_INCREMENT 不生效</span></span><br><span class="line">Id  <span class="keyword">uint64</span> <span class="string">`gorm:&quot;column:id;type:bigint(20);autoIncrement;comment:&#x27;主键&#x27;&quot;`</span></span><br><span class="line"><span class="comment">// AUTO_INCREMENT 生效 gorm会自动根据字段类型设置数据库字段类型并设置为主键</span></span><br><span class="line">Id  <span class="keyword">uint64</span> <span class="string">`gorm:&quot;column:id;autoIncrement;comment:&#x27;主键&#x27;&quot;`</span> <span class="comment">//写成AUTO_INCREMENT也可以</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>标签选项</th>
<th>使用说明</th>
</tr>
</thead>
<tbody><tr>
<td>column</td>
<td>指定 db 列名</td>
</tr>
<tr>
<td>type</td>
<td>列数据类型，推荐使用兼容性好的通用类型，例如：所有数据库都支持 bool、int、uint、float、string、time、bytes 并且可以和其他标签一起使用，例如：<code>not null</code>、<code>size</code>, <code>autoIncrement</code>… 像 <code>varbinary(8)</code> 这样指定数据库数据类型也是支持的。在使用指定数据库数据类型时，它需要是完整的数据库数据类型，如：<code>MEDIUMINT UNSIGNED not NULL AUTO_INCREMENT</code></td>
</tr>
<tr>
<td>size</td>
<td>指定列大小，例如：<code>size:256</code></td>
</tr>
<tr>
<td>primaryKey</td>
<td>指定列为主键</td>
</tr>
<tr>
<td>unique</td>
<td>指定列为唯一</td>
</tr>
<tr>
<td>default</td>
<td>指定列的默认值，字符串默认值用单引号，例：<code>gorm:&quot;default:&#39;cn&#39;&quot;</code></td>
</tr>
<tr>
<td>precision</td>
<td>指定列的精度</td>
</tr>
<tr>
<td>scale</td>
<td>指定列大小</td>
</tr>
<tr>
<td>not null</td>
<td>指定列为 NOT NULL</td>
</tr>
<tr>
<td>autoIncrement</td>
<td>指定列为自动增长，不可与<code>primaryKey</code>、<code>type</code>同时使用否则不生效，看上面<code>知识点</code>部分</td>
</tr>
<tr>
<td>autoIncrementIncrement</td>
<td>自动步长，控制连续记录之间的间隔</td>
</tr>
<tr>
<td>embedded</td>
<td>嵌套字段</td>
</tr>
<tr>
<td>embeddedPrefix</td>
<td>嵌入字段的列名前缀</td>
</tr>
<tr>
<td>autoCreateTime</td>
<td>创建时追踪当前时间，对于 <code>int</code> 字段，它会追踪秒级时间戳，您可以使用 <code>nano</code>/<code>milli</code> 来追踪纳秒、毫秒时间戳，例如：<code>autoCreateTime:nano</code></td>
</tr>
<tr>
<td>autoUpdateTime</td>
<td>创建/更新时追踪当前时间，对于 <code>int</code> 字段，它会追踪秒级时间戳，您可以使用 <code>nano</code>/<code>milli</code> 来追踪纳秒、毫秒时间戳，例如：<code>autoUpdateTime:milli</code></td>
</tr>
<tr>
<td>index</td>
<td>根据参数创建索引，多个字段使用相同的名称则创建复合索引，查看<a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/indexes.html">索引</a>获取详情</td>
</tr>
<tr>
<td>uniqueIndex</td>
<td>与 <code>index</code> 相同，但创建的是唯一索引</td>
</tr>
<tr>
<td>check</td>
<td>创建检查约束，例如 <code>check:age &gt; 13</code>，查看 <a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/constraints.html">约束</a> 获取详情</td>
</tr>
<tr>
<td>&lt;-</td>
<td>设置字段写入的权限， <code>&lt;-:create</code> 只创建、<code>&lt;-:update</code> 只更新、<code>&lt;-:false</code> 无写入权限、<code>&lt;-</code> 创建和更新权限</td>
</tr>
<tr>
<td>-&gt;</td>
<td>设置字段读的权限，<code>-&gt;:false</code> 无读权限</td>
</tr>
<tr>
<td>-</td>
<td>忽略该字段，<code>-</code> 无读写权限</td>
</tr>
<tr>
<td>comment</td>
<td>迁移时为字段添加注释</td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 内容模型</span></span><br><span class="line"><span class="keyword">type</span> Content <span class="keyword">struct</span> &#123;</span><br><span class="line">    Model</span><br><span class="line">    NewsId   <span class="keyword">uint64</span>  <span class="string">`gorm:&quot;column:news_id&quot;`</span></span><br><span class="line">    Content  <span class="keyword">string</span>  <span class="string">`gorm:&quot;column:content&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>知识点</code> 自定义唯一索引</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Go 版本：go1.16.6   Gorm 版本：v1.9.16</span></span><br><span class="line"><span class="comment">// 尝试用 uniqueIndex 创建不生效,有解决方法的同学欢迎评论区留言 普通索引是生效的</span></span><br><span class="line">Email <span class="keyword">string</span> <span class="string">`gorm:&quot;column:email;type:varchar(50);uniqueIndex:uidx_email&quot;`</span> <span class="comment">// 不生效</span></span><br><span class="line">Email <span class="keyword">string</span> <span class="string">`gorm:&quot;column:email;type:varchar(50);index:idx_email&quot;`</span>        <span class="comment">// 生效</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建唯一索引 建表时会创建名称为 email 的唯一索引</span></span><br><span class="line">Email <span class="keyword">string</span> <span class="string">`gorm:&quot;column:email;type:varchar(50);unique&quot;`</span></span><br><span class="line"><span class="comment">// 创建自定义名称 uidx_email 的唯一索引</span></span><br><span class="line">Email <span class="keyword">string</span> <span class="string">`gorm:&quot;column:email;type:varchar(50)&quot; sql:&quot;unique_index:uidx_email&quot;`</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>知识点</code> 自动更新时间</p>
<p><code>GORM</code>约定使用<code>CreatedAt</code>、<code>UpdatedAt</code>追踪创建/更新时间。如果定义了这种字段，且默认值为零值，<code>GORM</code>在创建、更新时会自动填充当前时间。要使用不同名称的字段，您可以配置<code>autoCreateTime</code>、<code>autoUpdateTime</code>标签，如果想要保存 UNIX（毫/纳）秒时间戳，而不是 time，只需简单地将 time.Time 修改为 int 即可，毫/纳秒参数可以看上面表格示例。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 时间自动创建和更新</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123; </span><br><span class="line">    <span class="comment">// 自定义字段  使用时间戳填纳秒数充更新时间 </span></span><br><span class="line">    Updated   <span class="keyword">int64</span> <span class="string">`gorm:&quot;autoUpdateTime:nano&quot;`</span> </span><br><span class="line">    <span class="comment">//自定义字段  使用时间戳毫秒数填充更新时间 </span></span><br><span class="line">    Updated   <span class="keyword">int64</span> <span class="string">`gorm:&quot;autoUpdateTime:milli&quot;`</span> </span><br><span class="line">    <span class="comment">//自定义字段  使用时间戳秒数填充创建时间 </span></span><br><span class="line">    Created   <span class="keyword">int64</span> <span class="string">`gorm:&quot;autoCreateTime&quot;`</span> </span><br><span class="line">    <span class="comment">// 默认创建时间字段  在创建时如果该字段值为零值，则使用当前时间填充 </span></span><br><span class="line">    CreatedAt time.Time </span><br><span class="line">    <span class="comment">// 默认更新时间字段  在创建时该字段值为零值或者在更新时，使用当前时间戳秒数填充 </span></span><br><span class="line">    UpdatedAt <span class="keyword">int</span>      </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注：GORM模型 <a href="https://link.juejin.cn/?target=https://gorm.io/zh_CN/docs/models.html">官方文档</a></p>
<h3 id="关联标签"><a href="#关联标签" class="headerlink" title="关联标签"></a>关联标签</h3><p>GORM的关联类型有多重类型：<code>belongs to</code>、<code>has one</code>、<code>has many</code>、<code>many to many</code>具体结构体定义可参考问<a target="_blank" rel="noopener" href="https://gorm.io/zh_CN/docs/belongs_to.html">文档</a>，关联模式使用的标签选项如下所示：</p>
<table>
<thead>
<tr>
<th>标签选项</th>
<th>使用说明</th>
</tr>
</thead>
<tbody><tr>
<td>foreignKey</td>
<td>指定当前模型的列作为连接表的外键 例：<code>gorm:&quot;foreignKey:FieldId&quot;</code> 其中FieldID是外键字段名</td>
</tr>
<tr>
<td>references</td>
<td>指定引用表的列名，其将被映射为连接表外键</td>
</tr>
<tr>
<td>polymorphic</td>
<td>指定多态类型，比如模型名</td>
</tr>
<tr>
<td>polymorphicValue</td>
<td>指定多态值、默认表名</td>
</tr>
<tr>
<td>many2many</td>
<td>指定连接表表名</td>
</tr>
<tr>
<td>joinForeignKey</td>
<td>指定连接表的外键列名，其将被映射到当前表</td>
</tr>
<tr>
<td>joinReferences</td>
<td>指定连接表的外键列名，其将被映射到引用表</td>
</tr>
<tr>
<td>constraint</td>
<td>关系约束，例如：<code>OnUpdate</code>、<code>OnDelete</code></td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新闻模型</span></span><br><span class="line"><span class="keyword">type</span> News <span class="keyword">struct</span> &#123;</span><br><span class="line">    Model</span><br><span class="line">    Title   <span class="keyword">string</span>   <span class="string">`gorm:&quot;column:title;type:string;not null,default:&#x27;&#x27;&quot;`</span></span><br><span class="line">    Content Content  <span class="string">`gorm:&quot;foreignKey:NewsId&quot; json:&quot;content&quot;`</span> <span class="comment">//指定外键</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注：GORM关联模型 <a href="https://link.juejin.cn/?target=https://gorm.io/zh_CN/docs/associations.html%23tags">官方文档</a></p>
<h2 id="form标签"><a href="#form标签" class="headerlink" title="form标签"></a>form标签</h2><p>Gin中提供了模型绑定，将表单数据和模型进行绑定，方便参数校验和使用。</p>
<h3 id="模型绑定"><a href="#模型绑定" class="headerlink" title="模型绑定"></a>模型绑定</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 表单数据</span></span><br><span class="line"><span class="keyword">type</span> LoginForm <span class="keyword">struct</span> &#123;</span><br><span class="line">    Email     <span class="keyword">string</span>    <span class="string">`form:&quot;emial&quot;`</span>    </span><br><span class="line">    Password  <span class="keyword">string</span>    <span class="string">`form:&quot;password&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// model 或 service 层Model</span></span><br><span class="line"><span class="keyword">type</span> Email <span class="keyword">struct</span> &#123;</span><br><span class="line">    Email       <span class="keyword">string</span></span><br><span class="line">    Password    <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>通过 form:”email” 对表单email数据进行绑定。然后通过Bind()、ShouldBind()等方法获取参数值。</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">EmailLogin</span> <span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> email LoginForm</span><br><span class="line">    <span class="keyword">if</span> err := c.ShouldBind(&amp;email); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取表单数据局</span></span><br><span class="line">    args := Email &#123;</span><br><span class="line">        Email:     email.Email,</span><br><span class="line">        Password:  email.Password,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 对参数进行后续使用</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="binding标签"><a href="#binding标签" class="headerlink" title="binding标签"></a>binding标签</h2><p>Gin对于数据的校验使用的是 <code>validator.v10</code> <a target="_blank" rel="noopener" href="https://github.com/go-playground/validator">包</a>，该包提供多种数据校验方法，通过<code>binding:&quot;&quot;</code>标签来进行数据校验。</p>
<p>我们对上面的表单模型添加数据校验标签如下：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> LoginForm <span class="keyword">struct</span> &#123;</span><br><span class="line">    Email     <span class="keyword">string</span>    <span class="string">`form:&quot;emial&quot; binding:&quot;email&quot;`</span>    </span><br><span class="line">    Password  <span class="keyword">string</span>    <span class="string">`form:&quot;password&quot; binging:&quot;required,min=6,max=10&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>特殊符号说明：</p>
<ul>
<li>逗号（,）:分隔多个标签选项，逗号之间不能有空格，否则panic；</li>
<li>横线（-）:跳过该字段不做校验；</li>
<li>竖线（|）:使用多个选项，满足其中一个即可。</li>
</ul>
<p>binding标签选项：</p>
<h3 id="必需校验"><a href="#必需校验" class="headerlink" title="必需校验"></a>必需校验</h3><table>
<thead>
<tr>
<th>标签选项</th>
<th>使用说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>required</td>
<td>表示该字段值必输设置，且不能为默认值</td>
<td><code>binding:required</code></td>
</tr>
<tr>
<td>omitempty</td>
<td>如果字段未设置，则忽略它</td>
<td><code>binding:reqomitemptyuired</code></td>
</tr>
</tbody></table>
<h3 id="范围校验"><a href="#范围校验" class="headerlink" title="范围校验"></a>范围校验</h3><p>范围验证: 切片、数组和map、字符串，验证其长度；数值，验证大小范围</p>
<table>
<thead>
<tr>
<th>标签选项</th>
<th>使用说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>len</td>
<td>参数值等于给定值</td>
<td><code>binding:&quot;len=8&quot;</code>等于8</td>
</tr>
<tr>
<td>ne</td>
<td>不等于</td>
<td><code>binding:&quot;ne=8&quot;</code>不等于8</td>
</tr>
<tr>
<td>max</td>
<td>最大值，小于等于参数值</td>
<td><code>binding:&quot;max=8&quot;</code>小于等于8</td>
</tr>
<tr>
<td>min</td>
<td>最小值，大于等于参数值</td>
<td><code>binding:&quot;min=8&quot;</code>大于等于8</td>
</tr>
<tr>
<td>lte</td>
<td>参数值小于等于给定值</td>
<td><code>binding:&quot;lte=8&quot;</code>小于等于8</td>
</tr>
<tr>
<td>gte</td>
<td>参数值大于等于给定值</td>
<td><code>binding:&quot;gte=8&quot;</code>大于等于8</td>
</tr>
<tr>
<td>lt</td>
<td>参数值小于给定值</td>
<td><code>binding:&quot;lt=8&quot;</code>小于8</td>
</tr>
<tr>
<td>gt</td>
<td>参数值大于给定值</td>
<td><code>binding:&quot;gt=8&quot;</code>大于8</td>
</tr>
<tr>
<td>oneof</td>
<td>参数值只能是枚举值中的一个，值必须是数值或字符串，以空格分隔，如果字符串中有空格，将字符串用单引号包围</td>
<td><code>binding:&quot;oneof=red green&quot;</code></td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`form:&quot;name&quot; binding:&quot;required,min=1,max=10&quot;`</span></span><br><span class="line">    Age  unit8  <span class="string">`form:&quot;age&quot; binding:&quot;lte=150,gte=0&quot;`</span></span><br><span class="line">    sex  <span class="keyword">string</span> <span class="string">`form:&quot;sex&quot; binding:&quot;oneof=male female&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注：<a target="_blank" rel="noopener" href="https://github.com/go-playground/validator/blob/master/README.md#comparisons">文档地址</a></p>
<h3 id="字符串校验"><a href="#字符串校验" class="headerlink" title="字符串校验"></a>字符串校验</h3><table>
<thead>
<tr>
<th>标签选项</th>
<th>使用说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>contains</td>
<td>参数值包含设置子串</td>
<td><code>binding:&quot;contains=tom&quot;</code>是否包含tom字符串</td>
</tr>
<tr>
<td>excludes</td>
<td>参数值不包含设置子串</td>
<td><code>binding:&quot;excludes=tom&quot;</code>是否不包含tom字符串</td>
</tr>
<tr>
<td>startswith</td>
<td>字符串前缀</td>
<td><code>binding:&quot;startswith=tom&quot;</code>是否以tom开头</td>
</tr>
<tr>
<td>endswith</td>
<td>字符串前缀</td>
<td><code>binding:&quot;endswith=tom&quot;</code>是否以tom结尾</td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`form:&quot;name&quot; binding:&quot;required,contains=ac,endswith=ck&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注：<a target="_blank" rel="noopener" href="https://github.com/go-playground/validator/blob/master/README.md#strings">文档地址</a></p>
<h3 id="字段校验"><a href="#字段校验" class="headerlink" title="字段校验"></a>字段校验</h3><table>
<thead>
<tr>
<th>标签选项</th>
<th>使用说明</th>
</tr>
</thead>
<tbody><tr>
<td>eqcsfield</td>
<td>跨不同结构体字段相等，比如<code>struct1 field1</code> 是否等于<code>struct2 field2</code></td>
</tr>
<tr>
<td>necsfield</td>
<td>跨不同结构体字段不相等</td>
</tr>
<tr>
<td>eqfield</td>
<td>同一结构体字段相等验证，例如：输入两次密码</td>
</tr>
<tr>
<td>nefield</td>
<td>同一结构体字段不相等验证</td>
</tr>
<tr>
<td>gtefield</td>
<td>大于等于同一结构体字段</td>
</tr>
<tr>
<td>ltefield</td>
<td>小于等于同一结构体字段</td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跨不同结构体字段相等</span></span><br><span class="line"><span class="keyword">type</span> Struct1 <span class="keyword">struct</span> &#123; </span><br><span class="line">    Field1 <span class="keyword">string</span> <span class="string">`validate:eqcsfield=Struct2.Field2`</span> </span><br><span class="line">    Struct2 <span class="keyword">struct</span> &#123; </span><br><span class="line">        Field2 <span class="keyword">string</span> </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 同一结构体字段相等验证</span></span><br><span class="line"><span class="keyword">type</span> Email <span class="keyword">struct</span> &#123; </span><br><span class="line">    Email  <span class="keyword">string</span> <span class="string">`validate:&quot;lte=4&quot;`</span> </span><br><span class="line">    Pwd    <span class="keyword">string</span> <span class="string">`validate:&quot;min=10&quot;`</span> </span><br><span class="line">    Pwd2   <span class="keyword">string</span> <span class="string">`validate:&quot;eqfield=Pwd&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 同一结构体字段验证不相等</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123; </span><br><span class="line">    Name     <span class="keyword">string</span> <span class="string">`validate:&quot;lte=4&quot;`</span> </span><br><span class="line">    Age      <span class="keyword">int</span> <span class="string">`validate:&quot;min=20&quot;`</span> </span><br><span class="line">    Password <span class="keyword">string</span> <span class="string">`validate:&quot;min=10,nefield=Name&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="其他校验"><a href="#其他校验" class="headerlink" title="其他校验"></a>其他校验</h3><table>
<thead>
<tr>
<th>标签选项</th>
<th>使用说明</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>ip</td>
<td>合法IP地址校验</td>
<td><code>binding:&quot;ip&quot;</code></td>
</tr>
<tr>
<td>email</td>
<td>合法邮箱校验</td>
<td><code>binding:&quot;email&quot;</code></td>
</tr>
<tr>
<td>url</td>
<td>合法的URL</td>
<td><code>binding:&quot;url&quot;</code></td>
</tr>
<tr>
<td>uri</td>
<td>合法的URI</td>
<td><code>binding:&quot;uri&quot;</code></td>
</tr>
<tr>
<td>uuid</td>
<td>uuid验证</td>
<td><code>binding:&quot;uuid&quot;</code></td>
</tr>
<tr>
<td>datetime</td>
<td>合法时间格式值校验</td>
<td><code>binding:&quot;datetime=2006-01-02&quot;</code></td>
</tr>
<tr>
<td>json</td>
<td>JSON数据验证</td>
<td><code>validate:&quot;json&quot;</code></td>
</tr>
<tr>
<td>numeric</td>
<td>数值验证 正则：<code>^[-+]?[0-9]+(?:\\.[0-9]+)?$</code></td>
<td><code>validate:&quot;numeric&quot;</code></td>
</tr>
<tr>
<td>number</td>
<td>整数验证 正则：<code>^[0-9]+$</code></td>
<td><code>validate:&quot;number&quot;</code></td>
</tr>
<tr>
<td>alpha</td>
<td>字母字符串验证 正则：<code>^[a-zA-Z]+$</code></td>
<td><code>validate:&quot;alpha&quot;</code></td>
</tr>
<tr>
<td>alphanum</td>
<td>字母数字字符串验证 正则：<code>^[a-zA-Z0-9]+$</code></td>
<td><code>validate:&quot;alphanum&quot;</code></td>
</tr>
<tr>
<td>ascii</td>
<td>Ascii 字符验证</td>
<td><code>validate:&quot;ascii&quot;</code></td>
</tr>
</tbody></table>
<p>示例：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123; </span><br><span class="line">    Name     <span class="keyword">string</span>  <span class="string">`validate:&quot;required,min=1,max=10&quot;`</span> </span><br><span class="line">    Email    <span class="keyword">int</span>     <span class="string">`validate:&quot;required,email&quot;`</span></span><br><span class="line">    birthday <span class="keyword">string</span>  <span class="string">`validate:&quot;datetime=2006-01-02&quot;`</span></span><br><span class="line">    Pwd      <span class="keyword">string</span>  <span class="string">`validate:&quot;required,alphanum&quot;`</span></span><br><span class="line">    Score    srring  <span class="string">`validate:&quot;numeric&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注：<a target="_blank" rel="noopener" href="https://github.com/go-playground/validator/blob/master/README.md#network">文档地址</a></p>
<h2 id="ini标签"><a href="#ini标签" class="headerlink" title="ini标签"></a>ini标签</h2><p>在使用<code>go-ini</code>库操作.ini配置文件的时候，如果需要将配置文件字段映射到结构体变量，如果键名与字段名不相同，那么需要在结构标签中指定对应的键名。标准库<code>encoding/json</code>、<code>encoding/xml</code>解析时可以将键名<code>app_name</code>对应到字段名<code>AppName</code>，而go-ini库不可以，所以需要在结构体标签指定对应键名。</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 配置文件 cnf.ini</span></span><br><span class="line"><span class="attr">app_name</span>  = awesome web</span><br><span class="line"><span class="attr">log_level</span> = DEBUG</span><br><span class="line"></span><br><span class="line">// 配置文件映射 结构体</span><br><span class="line">type Config struct &#123;</span><br><span class="line">  AppName   string `ini:&quot;app_name&quot;`  // ini标签指定下键名</span><br><span class="line">  LogLevel  string `ini:&quot;log_level&quot;`</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</article>

    <div class="pagenator post-pagenator">
    
    
        <a class="extend prev post-prev" href="/2022/05/24/Mac-redis-%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8/">prev</a>
    

    
    <p>last update time 2023-06-06</p>
    
    
        <a class="extend next post-next" href="/2022/05/12/docker%20%E5%AE%89%E8%A3%85gitea/">next</a>
    
    </div>


    </div>
    <div class="footer">
        <div class="container">
    <div class="social">
	<ul class="social-list">
		
			
				
				
				<li>
					<a href="mailto:867869344@qq.com" title="email" target="_blank">
					<i class="fa fa-email"></i>
					</a>
				</li>
			
		
			
		
			
		
			
		
			
		
			
		
			
				
				<li>
					<a href="https://github.com/feel-easy" title="github" target="_self">
					<i class="fa fa-github"></i>
					</a>
				</li>
			
		
			
		
			
		
			
		
			
				
				<li>
					<a href="https://www.jianshu.com/u/df8ad5309e07" title="jianshu" target="_self">
					<i class="fa fa-jianshu"></i>
					</a>
				</li>
			
		
			
		
			
		
			
		
	</ul>
</div>
    <div class="copyright">
        <span>
            
            
            
                © len 2021 - 2025
            
        </span>
        <span>
            <a href="https://beian.miit.gov.cn/" target="_blank">京ICP备2022032160号-1</a>
        </span>
    </div>
    <div class="power">
        <span>
            Powered by <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a> & <a target="_blank" rel="noopener" href="https://github.com/CaiChenghan/iLiKE">iLiKE Theme</a>
        </span>
    </div>
    <!-- <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script> -->
    <!--page counter part-->

</div>

    </div>
</body>
</html>
